{% extends "simplechat/base.html" %}

{% block headscripts %}
    <script>
        var name = prompt("Enter your nickname");
        var url;
        if (name === "" || name === "null") {
            location.href = "{% url 'simplechat:index' %}";
        }
        add_user(name);
        function add_user(name) {
            $.post(
                    "{% url 'simplechat_api:participant_list' %}",
                    {
                        "room": {{room.id}},
                        "name": name
                    },
                    function (data) {
                        url = data.url;
                    }
            )
        }
        function delete_user() {
            $.ajax({
                url: url,
                method: "delete",
                success: function () {
                    location.href = "{% url 'simplechat:index' %}";
                }
            });
        }
    </script>
{% endblock %}
{% block bodyscripts %}
    <script>
        $(document).ready(function () {
            $("#logout").click(delete_user);
            $("#greetings").text($("#greetings").text() + ", " + name);
            $("#people_list").append($("<li id='"+url+"'>").text(name));
        });
    </script>
{% endblock %}
{% block content %}
<h1 id="greetings">Welcome to room {{ room.id }}</h1>
<p>People in this room:</p>
<ul id="people_list">
    {% for participant in room.participant_set.all %}
        <li>{{ participant.name }}</li>
    {% endfor %}
</ul>
<p>Had enough? <a id="logout">Leave room.</a></p>
{% endblock %}
